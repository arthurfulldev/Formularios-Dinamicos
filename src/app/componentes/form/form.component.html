<div class="container">
    <blockquote class="blockquote text center">
        <i class="fas fa-file-code"></i> Crear campos.
    </blockquote>
    <div class="accordion" id="groupFields" [formGroup]="dinamicForm">

        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nombre campo</th>
                        <th scope="col">Requerido</th>
                        <th scope="col">Reglas</th>
                        <th scope="col">
                            <div class="d-flex justify-content-center">
                                <span class="btn btn-success btn-sm" (click)="addField()"><i class="fas fa-plus"></i></span>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody *ngFor="let field of dinamicForm.value | keyobj; trackBy:trackByFn" formGroupName="{{field.key}}">
                    <tr>
                        <th scope="row">{{field.key | ruleName:6}}</th>
                        <td><input class="form-control" type="text" name="name" formControlName="name" placeholder="Nombre del campo" data-toggle="tooltip" title="Escribe el nombre del campo"></td>
                        <td>
                            <input type="checkbox" formControlName="isRequired">
                        </td>
                        <td (click)="mostrar('#'+field.key)">
                            <div class="d-flex justify-content-center">
                                <i class="{{ !hide ? 'far fa-eye' : 'far fa-eye-slash' }}" (click)="hide = !hide" data-toggle="tooltip" title="{{ hide ? 'Ver reglas de este campo.': 'Ocultar reglas de este campo.' }}"></i>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <i class="btn btn-sm btn-danger far fa-trash-alt" (click)='removeField(field.key)' data-toggle="tooltip" title="Borrar este campo."></i>
                            </div>
                        </td>
                    </tr>
                    <td colspan="5" class="collapse border border-info" id="{{field.key}}" data-parent="#groupFields">
                            <div class="container table-responsive">
                                <strong>Reglas: </strong>
                                <table class="table table-striped border border-info shadow-lg bg-white rounded">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Nombre regla</th>
                                            <th scope="col">Argumentos</th>
                                            <th scope="col">
                                                <div class="d-flex justify-content-center">
                                                    <span class="btn btn-success btn-sm"><i class="fas fa-plus"></i></span>
                                                </div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td scope="row">1</td>
                                            <!-- <td scope="row">{{ rule.key | ruleName }} </td> -->
                                            <td>
                                                <div class="form-group">
                                                    <select class="form-control" >
                                                        <option value="0">-- Regla --</option>
                                                        <option *ngFor="let rule of rules; let i = index" value="{{i+1}}" >{{rule.name}}</option>
                                                    </select>
                                                </div>
                                            </td>
                                            <td class="pb-3">
                                                
                                            </td>
                                            <td>
                                                <div class="d-flex justify-content-center">
                                                    <i class="btn btn-sm btn-danger far fa-trash-alt" data-toggle="tooltip" title="Borrar esta regla."></i>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </td>
                </tbody>
            </table>
        </div>
    </div>
</div>

<br>{{ dinamicForm.value | json}}
<!-- <input type="button" (click)="addField()" value="Nuevo campo"> -->

<div [formGroup]="dinamicForm">
        <div *ngFor="let field of dinamicForm.value | keyobj; trackBy:trackByFn" formGroupName="{{field.key}}">
            {{field.key}} {{field.value | json}} <br>
            <input type="text" value="{{field.value.name}}" formControlName="name"> 
            <input type="checkbox" value="{{field.value.name}}" formControlName="isRequired">
            
            <div *ngIf="field.value.reglas">
                <div formGroupName="reglas">
                    <div *ngFor="let regla of field.value.reglas | keyobj" formGroupName="{{regla.key}}">
                        <select type="select" formControlName="name">
                            <option value="0">-- Regla --</option>
                            <option *ngFor="let rule of rules; let i = index" value="{{i+1}}">{{rule.name}}</option>
                        </select>
                        {{ regla.key }} 
                        <input type="button" (click)="addArgument(field.key, regla.key)" value="Agregar Argumento">
                        <!-- <input type="button" (click)="removeArgument(field.key, regla.key)" value="Eliminar Argumentos"> -->
                    </div>
                </div>
            </div>
    
            <!-- <input type="button" value="Eliminar campo" (click)='removeField(field.key)'> -->
            <input type="button" (click)="addRule(field.key)" value="Nueva regla.">
        </div>
    </div>